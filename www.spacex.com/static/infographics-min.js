const dpr=window.devicePixelRatio||1,simplex=new SimplexNoise("1234567890abcdefghijklmnopqrstuvwxyz"),translate=([e,t])=>({r:a,theta:n})=>[e+a*Math.cos(n),t+a*Math.sin(n)],range=e=>Array.from(Array(e).keys()),degreesToRadians=e=>Math.PI*e/180,arcs=(e,t,a=0)=>{const n=360/e;return range(e).map(e=>({theta:degreesToRadians(a+n*e),r:t}))},displacePt=(e,t,a)=>({r:a,theta:n},r)=>({r:a+a*e*simplex.noise3D(Math.cos(n),Math.sin(n),t),theta:n}),generateCircle=(e,t,a,{segmentCount:n,displacement:r})=>R.pipe(e=>arcs(n,e),R.map(displacePt(r,a)),R.map(translate([e/2,t/2]))),drawShape=(e,[t,...a],n=!0)=>{e.beginPath(),e.moveTo(...t),a.forEach(t=>{e.lineTo(...t)}),n&&e.closePath()},Infographics=()=>{const e={hover:queryAll(".js-hover"),step:queryAll(".js-step")},t={lines:[{scale:0,alpha:0,displacement:0},{scale:0,alpha:0,displacement:0},{scale:0,alpha:0,displacement:0}]},a=PERF>=PERFS.PERF_HIGH?180:PERF>=PERFS.PERF_GOOD?180:90,n=[{el:document.createElement("canvas"),ctx:null,playing:!1},{el:document.createElement("canvas"),ctx:null,playing:!1}];scroller||document.body;n.forEach(e=>{e.ctx=e.el.getContext("2d"),scroller.appendChild(e.el)});let r;n.forEach(e=>{e.ctx.scale(dpr,dpr),e.el.width=200*dpr,e.el.height=200*dpr,assign(e.el.style,{position:"absolute",top:0,left:0,width:"200px",height:"200px",pointerEvents:"none",mixBlendMode:"difference"})});let o=0,s=!1;const l=()=>{s=!0,o+=.001,n.forEach(e=>{if(e.playing){e.ctx.clearRect(0,0,200*dpr,200*dpr),e.ctx.lineWidth=1.5,e.ctx.strokeStyle="#fff";for(let n=t.lines.length-1;n>=0;n--){const{scale:r,alpha:s,displacement:l}=t.lines[n],i=200*dpr/2*r,c=generateCircle(200*dpr,200*dpr,o,{segmentCount:a,displacement:l})(i);e.ctx.globalAlpha=s,drawShape(e.ctx,c,!0),e.ctx.stroke(),e.ctx.globalAlpha=1}}})};let i=0,c=0;const d=e=>{n.forEach(e=>e.playing=!1),e.forEach((e,t)=>{const a=e.getBoundingClientRect(),r=a.width/2;i=a.left-100+r,c=SMOOTH_SCROLLING+a.top-100+r,TweenMax.set(n[t].el,{x:i,y:c}),n[t].playing=!0}),r=new TimelineMax({paused:!0,repeat:-1,repeatDelay:0,onUpdate:l,onComplete:()=>s=!1}).staggerTo(t.lines,1,{alpha:1,ease:Linear.easeNone},-1,1).staggerFromTo(t.lines,5,{scale:0},{cycle:{scale:[.8,.75,.7]},ease:Linear.easeNone},-1,.5).staggerFromTo(t.lines,5,{displacement:0},{displacement:.075,ease:Linear.easeNone},-1.5,1.75).staggerTo(t.lines,2,{alpha:0,ease:Linear.easeNone},-.5,3.5).restart()},p=(e=(()=>{}))=>{TweenMax.killTweensOf(t.lines),TweenMax.to(t.lines,.2,{alpha:0,ease:Expo.easeOut,onComplete:()=>{r&&r.clear(),n.forEach(e=>e.playing=!1),e()}})};let h=null;const g=a=>{const n=a.currentTarget,r=n.querySelector(".img"),o=n.querySelector("small"),l=e.step.filter(e=>e.getAttribute("data-index")===n.getAttribute("data-index"));e.hover.forEach(e=>TweenMax.to(e,.3,{autoAlpha:e===n?1:.25})),TweenMax.to(l,.5,{attr:{r:18},repeat:-1,yoyo:!0,ease:Power2.easeOut}),TweenMax.fromTo(n.querySelector("p"),.4,{x:10,autoAlpha:0},{x:0,autoAlpha:1,force3D:!0}),o&&TweenMax.fromTo(o,.45,{scrambleText:{text:"00.00.00"}},{scrambleText:{text:n.getAttribute("data-timecode"),chars:"01"}}),r&&(h=TweenMax.fromTo(r,1,{autoAlpha:0,y:"-105%"},{autoAlpha:1,y:"-100%",repeat:2,ease:Quint.easeOut,yoyo:!0,force3D:!0})),(e=>{TweenMax.killTweensOf(t.lines);const a=()=>d(e);s?p(a):a()})(l)},u=t=>{const a=t.currentTarget,n=a.querySelector(".img"),r=a.querySelector("p");n&&(TweenMax.killTweensOf(n),TweenMax.to(n,.2,{autoAlpha:0})),TweenMax.to(e.hover,.3,{autoAlpha:1}),TweenMax.staggerTo(e.step,.4,{attr:{r:10}}),TweenMax.to(r,.2,{autoAlpha:0}),p()},x=t=>{const a=t.currentTarget.getAttribute("data-index"),n=e.hover.find(e=>e.getAttribute("data-index")===a);g({currentTarget:n})},m=t=>{const a=t.currentTarget.getAttribute("data-index"),n=e.hover.find(e=>e.getAttribute("data-index")===a);u({currentTarget:n})};let T=!1;const f=e=>{const t=e.currentTarget,a={currentTarget:t};if(T){const e=t.querySelector("img"),n=t.querySelector("p");e&&(TweenMax.killTweensOf(e),TweenMax.to(e,.2,{autoAlpha:0})),TweenMax.to(n,.2,{autoAlpha:0}),setTimeout(()=>g(a),1)}else T=!0,g(a)};e.hover.forEach(e=>{deviceSettings.isDesktop?(e.addEventListener("mouseenter",g),e.addEventListener("mouseleave",u)):e.addEventListener("click",f)}),e.step.length&&e.step.forEach(e=>{e.addEventListener("click",x),deviceSettings.isDesktop&&(e.addEventListener("mouseenter",x),e.addEventListener("mouseleave",m))}),window.addEventListener("scroll",()=>{deviceSettings.isDesktop&&s&&p()})};deviceSettings.isDesktop&&("loading"!=document.readyState?Infographics():document.addEventListener("DOMContentLoaded",Infographics));